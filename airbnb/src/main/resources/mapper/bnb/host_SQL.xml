<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.sy.bnb.dao.hostDAO">
	  
	<insert id="insertLodging" parameterType="LodgingVo" useGeneratedKeys="true"
			  keyProperty="l_id" keyColumn="l_id">
		<selectKey keyProperty="l_id" resultType="String" order="BEFORE">
			SELECT 'L' || TO_CHAR(NVL(TO_NUMBER(SUBSTR(MAX(L_ID), 2, 3)), 0) +1, 'FM000')
			FROM LODGING_TBL
		</selectKey>
		INSERT INTO LODGING_TBL(L_ID, USER_EMAIL, L_NAME, L_ADDR, S_ID, CHECKIN, CHECKOUT
								,BATH_EA, BEDROOM_EA, BED_EA, L_EXP, BASIC_PERSON, ADD_PERSON, PRICE)
		VALUES(#{l_id}, #{user_email}, #{l_name}, #{l_addr}, #{building_code}, TO_TIMESTAMP('14:00', 'HH24:MI'),TO_TIMESTAMP('11:00', 'HH24:MI')
				,#{bath_ea}, #{bedroom_ea}, #{bed_ea}, #{l_exp}, #{basic_person}, 0, #{basic_price})
	</insert>
	
	<insert id="insertLodgingFacility" parameterType="LodgingVo">
		INSERT INTO LODGING_FACILITY_TBL(LF_ID, L_ID, F_ID)
		SELECT LF_SEQ.nextval as LF_ID, A.*
		FROM
		<foreach collection="facility_list" item="item" separator="UNION ALL" open="(" close=")A">
			SELECT #{l_id} as L_ID, #{item} as F_ID
			FROM DUAL
		</foreach>
	</insert>
	
	<insert id="insertPictures" parameterType="LodgingVo">
		INSERT INTO LODGING_PIC_TBL(PIC_ID, L_ID, PIC_URL)
		SELECT PIC_SEQ.nextval as PIC_ID, A.*
		FROM
		<foreach collection="pic_path_list" item="item" separator="UNION ALL" open="(" close=")A">
			SELECT #{l_id} as L_ID, #{item} as PIC_URL
			FROM DUAL
		</foreach>
	</insert>
	
	<insert id="insertLodgingManage" parameterType="LodgingVo">
		
	</insert>
	
	<select id="getFacility" resultType="hashmap">
		SELECT F_ID, F_P_NAME, F_NAME, F_ICON_ID
		FROM FACILITY_TBL
	</select>
	
	<select id="getStructure" resultType="hashmap">
		SELECT S_ID, S_NAME, S_ICON_URL
		FROM STRUCTURE_TBL
	</select>
	
	<select id="getUserLodging" resultType="LodgingVo">
		SELECT A.L_ID, L_NAME, PRICE as basic_price, PIC_URL AS main_pic
		FROM LODGING_TBL A
		INNER JOIN LODGING_PIC_TBL B
		ON A.L_ID = B.L_ID
		WHERE USER_EMAIL = #{user_email}
		AND PIC_MAIN = '1'
	</select>
	
	
</mapper>